<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equipe [ODIO] - Oficial</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Oswald', sans-serif; background:#050505; color:#eee; }
.admin-only { display:none; }
button { cursor:pointer; }
</style>
</head>
<body>

<!-- BANNER -->
<section class="w-full h-[250px] bg-zinc-900 border-b-4 border-red-600"></section>

<!-- NAV -->
<nav class="max-w-6xl mx-auto flex justify-between items-center p-6 bg-zinc-900 border-b border-zinc-800">

  <div class="flex gap-4">
    <button onclick="abrirModal()"
      class="bg-red-600 px-6 py-2 rounded text-xs font-bold uppercase">
      Alistar-se
    </button>

    <button onclick="abrirLogin()"
      class="bg-blue-600 px-6 py-2 rounded text-xs font-bold uppercase">
      Login
    </button>
  </div>

  <button onclick="loginAdmin()" class="text-white text-xs uppercase">
    Painel Admin
  </button>

</nav>

<main class="max-w-6xl mx-auto p-6">

<section id="adminPanel" class="admin-only bg-zinc-900 p-6 rounded border-2 border-yellow-600 mb-6">
<h3 class="text-yellow-500 font-bold mb-3 uppercase">
Recrutas
</h3>
<div id="listaEspera" class="space-y-2"></div>

<h3 class="text-yellow-500 font-bold mt-6 mb-3 uppercase">
Aprovados (<span id="contagemAprovados"></span>)
</h3>
<div id="listaAprovados" class="space-y-2"></div>
</section>

</main>

<!-- MODAL CADASTRO -->
<div id="modalCadastro" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden">
<div class="bg-zinc-900 p-8 rounded border border-red-600 w-full max-w-md">

<h2 class="text-xl font-bold mb-4 text-center uppercase">Alistamento</h2>

<input id="regNome" placeholder="Nome no COD"
class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">

<input id="regEmail" placeholder="Email"
class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">

<input id="regFone" placeholder="Telefone"
class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-4">

<button onclick="solicitarEntrada()"
class="w-full bg-red-600 py-3 font-bold uppercase">
Enviar Cadastro
</button>

<button onclick="fecharModal()"
class="w-full text-zinc-500 text-xs uppercase mt-3">
Fechar
</button>

</div>
</div>

<!-- MODAL LOGIN -->
<div id="modalLogin" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden">
<div class="bg-zinc-900 p-8 rounded border border-blue-600 w-full max-w-md">

<h2 class="text-xl font-bold mb-4 text-center uppercase">Login</h2>

<input id="loginEmail" placeholder="Email"
class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">

<input id="loginSenha" type="password" placeholder="Senha"
class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-4">

<button onclick="fazerLogin()"
class="w-full bg-blue-600 py-3 font-bold uppercase">
Entrar
</button>

<button onclick="fecharLogin()"
class="w-full text-zinc-500 text-xs uppercase mt-3">
Fechar
</button>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* üî• COLOQUE AQUI SUA CONFIG REAL DO FIREBASE */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_BUCKET",
  messagingSenderId: "SEU_MSG_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const docRef = doc(db,"site","dados");

let espera = [];
let aprovados = [];
let isAdmin = false;

/* INICIALIZA */
async function init(){
  const snap = await getDoc(docRef);
  if(!snap.exists()){
    await setDoc(docRef,{espera:[],aprovados:[]});
  }
}
await init();

/* REALTIME */
onSnapshot(docRef,(snap)=>{
  if(snap.exists()){
    const d = snap.data();
    espera = d.espera || [];
    aprovados = d.aprovados || [];
    renderAdmin();
  }
});

async function salvar(){
  await setDoc(docRef,{espera,aprovados});
}

/* MODAIS */
window.abrirModal=()=>modalCadastro.classList.remove("hidden");
window.fecharModal=()=>modalCadastro.classList.add("hidden");
window.abrirLogin=()=>modalLogin.classList.remove("hidden");
window.fecharLogin=()=>modalLogin.classList.add("hidden");

/* CADASTRO */
window.solicitarEntrada=async()=>{
  const nome=regNome.value.trim();
  const email=regEmail.value.trim();
  const fone=regFone.value.trim();

  if(!nome||!email||!fone){
    alert("Preencha todos os campos");
    return;
  }

  const eClan=confirm("Voc√™ √© de algum clan?");
  let clan="";
  if(eClan){
    clan=prompt("Qual nome do clan?");
    if(!clan){ alert("Informe o nome do clan"); return; }
  }

  espera.push({
    nome,email,fone,clan,
    senha:"",
    primeiroAcesso:true,
    id:Date.now()
  });

  await salvar();
  alert("Cadastro enviado!");
  fecharModal();
};

/* LOGIN */
window.fazerLogin=async()=>{
  const email=loginEmail.value.trim();
  const senha=loginSenha.value.trim();

  const user=aprovados.find(u=>u.email===email);
  if(!user){
    alert("Usu√°rio n√£o aprovado!");
    return;
  }

  if(user.primeiroAcesso){
    const nova=prompt("Primeiro acesso! Crie senha alfanum√©rica (m√≠n 6)");
    if(!nova||nova.length<6||!/\d/.test(nova)||!/[a-zA-Z]/.test(nova)){
      alert("Senha inv√°lida");
      return;
    }
    user.senha=nova;
    user.primeiroAcesso=false;
    await salvar();
    alert("Senha criada! Fa√ßa login novamente.");
    return;
  }

  if(user.senha!==senha){
    alert("Senha incorreta!");
    return;
  }

  alert(`Bem-vindo ${user.nome} ${user.clan? "- Clan: "+user.clan:""}`);
  fecharLogin();
};

/* ADMIN */
window.loginAdmin=()=>{
  const s=prompt("Senha Admin:");
  if(s==="123"){
    isAdmin=true;
    document.querySelectorAll(".admin-only")
    .forEach(e=>e.style.display="block");
  }
};

window.aprovar=async(id)=>{
  const idx=espera.findIndex(p=>p.id===id);
  if(idx===-1)return;
  const j=espera.splice(idx,1)[0];
  aprovados.push(j);
  await salvar();
};

window.reprovar=async(id)=>{
  espera=espera.filter(p=>p.id!==id);
  await salvar();
};

/* RENDER */
function renderAdmin(){
  contagemAprovados.textContent=aprovados.length;

  listaEspera.innerHTML="";
  espera.forEach(p=>{
    listaEspera.innerHTML+=`
    <div class="bg-black p-2 rounded flex justify-between">
      <span>${p.nome}</span>
      <div>
        <button onclick="aprovar(${p.id})"
        class="bg-green-600 px-2 py-1 text-xs">Aprovar</button>
        <button onclick="reprovar(${p.id})"
        class="bg-red-600 px-2 py-1 text-xs">X</button>
      </div>
    </div>`;
  });

  listaAprovados.innerHTML="";
  aprovados.forEach(p=>{
    listaAprovados.innerHTML+=`
    <div class="bg-black p-2 rounded">
      ${p.nome} ${p.clan? "- Clan: "+p.clan:""}
    </div>`;
  });
}

</script>
</body>
</html>
