<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equipe [ODIO] - Oficial</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Oswald',sans-serif;background:#050505;color:#eee;}

.admin-only{display:none;}
.admin-active .admin-only{display:revert;}

#btnLogout{display:none;}
.admin-active #btnLogout{display:inline-block;}

.equipe{padding:10px;margin:5px 0;border-radius:8px;color:#000;}
button{cursor:pointer;}
</style>
</head>
<body>

<!-- BANNER -->
<section class="relative w-full h-[300px] md:h-[400px] bg-zinc-900 border-b-4 border-red-600">
<img id="bannerImg" class="w-full h-full object-cover opacity-60">
</section>

<!-- NAV -->
<nav class="max-w-6xl mx-auto flex justify-between items-center p-6 bg-zinc-900 border-b border-zinc-800">
<div class="flex gap-4">
<button onclick="adicionarJogador()" class="bg-red-600 px-6 py-2 rounded text-xs font-bold uppercase">
Alistar-se
</button>
</div>

<div class="flex gap-3">
<button onclick="loginAdmin()">Painel Admin</button>
<button id="btnLogout" onclick="logoutAdmin()" class="text-red-600 text-xs uppercase font-bold">
Sair
</button>
</div>
</nav>

<main class="max-w-6xl mx-auto p-4 mt-8 space-y-10">

<section class="admin-only bg-zinc-900 p-6 rounded border-2 border-yellow-600 space-y-6">

<h3 class="text-yellow-500 font-bold uppercase">Lista de Aprovados</h3>
<div id="listaAprovados" class="space-y-2"></div>

<hr class="border-zinc-700">

<h3 class="text-yellow-500 font-bold uppercase">Sorteador</h3>
<button onclick="sortearEquipes()" class="bg-blue-600 px-4 py-2 rounded text-xs">
Sortear Times
</button>
<div id="equipesContainer" class="mt-2"></div>

</section>

<div class="bg-zinc-900 rounded border border-zinc-800 overflow-hidden">
<table class="w-full text-left">
<thead class="bg-black text-zinc-500 text-xs uppercase">
<tr>
<th class="p-4">Rank</th>
<th class="p-4">Nome</th>
<th class="p-4 text-center">Partidas</th>
<th class="p-4 text-center text-red-500">Kills</th>
<th class="p-4 text-right admin-only">Ações</th>
</tr>
</thead>
<tbody id="rankBody"></tbody>
</table>
</div>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot } from
"https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SUA_AUTH",
  projectId: "SUA_PROJECT"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const docRef = doc(db,"site","dados");

let aprovados=[];

/* LISTENER DIRETO (SEM await) */
onSnapshot(docRef, snap=>{
  if(!snap.exists()){
    setDoc(docRef,{rank:[]});
    return;
  }

  aprovados=snap.data().rank||[];
  renderRank();
  renderLista();
});

/* SALVAR */
function salvar(){
  setDoc(docRef,{rank:aprovados},{merge:true});
}

/* ADMIN */
window.loginAdmin=()=>{
  const senha=prompt("Senha Admin:");
  if(senha==="123"){
    document.body.classList.add("admin-active");
  }
};

window.logoutAdmin=()=>{
  document.body.classList.remove("admin-active");
};

/* ADICIONAR */
window.adicionarJogador=()=>{
  const nome=prompt("Nome:");
  if(!nome) return;
  aprovados.push({nome,matches:0,kills:0});
  salvar();
};

/* REMOVER */
window.removerJogador=(nome)=>{
  if(!confirm("Remover?")) return;
  aprovados=aprovados.filter(p=>p.nome!==nome);
  salvar();
};

/* RENDER LISTA */
function renderLista(){
  listaAprovados.innerHTML="";
  aprovados.forEach(p=>{
    listaAprovados.innerHTML+=`
    <div class="flex justify-between bg-black p-2 rounded">
      <span>${p.nome}</span>
      <button onclick="removerJogador('${p.nome}')" 
      class="bg-red-600 px-2 text-xs rounded admin-only">
      Remover
      </button>
    </div>`;
  });
}

/* RANK */
window.addScore=(nome)=>{
  const k=parseInt(prompt("Kills","0"))||0;
  const idx=aprovados.findIndex(p=>p.nome===nome);
  if(idx>-1){
    aprovados[idx].matches+=1;
    aprovados[idx].kills+=k;
    salvar();
  }
};

function renderRank(){
  rankBody.innerHTML="";
  aprovados
  .sort((a,b)=>b.kills-a.kills)
  .forEach((p,i)=>{
    rankBody.innerHTML+=`
    <tr class="border-b border-zinc-800">
      <td class="p-4">#${i+1}</td>
      <td class="p-4">${p.nome}</td>
      <td class="p-4 text-center">${p.matches}</td>
      <td class="p-4 text-center text-red-500">${p.kills}</td>
      <td class="p-4 text-right admin-only">
        <button onclick="addScore('${p.nome}')" 
        class="bg-blue-600 px-2 py-1 text-xs rounded">
        +K
        </button>
      </td>
    </tr>`;
  });
}

/* SORTEADOR */
window.sortearEquipes=()=>{
  if(aprovados.length<2) return alert("Precisa de 2 jogadores");

  const lista=[...aprovados].sort(()=>Math.random()-0.5);
  const meio=Math.ceil(lista.length/2);

  const t1=lista.slice(0,meio).map(p=>p.nome);
  const t2=lista.slice(meio).map(p=>p.nome);

  equipesContainer.innerHTML=`
  <div class="equipe bg-red-500">Equipe 1: ${t1.join(", ")}</div>
  <div class="equipe bg-blue-500">Equipe 2: ${t2.join(", ")}</div>`;
};

</script>
</body>
</html>
