<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equipe [ODIO] - Oficial</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Oswald', sans-serif; background: #050505; color: #eee; }

.admin-only { display: none; }
.admin-active .admin-only { display: revert; }

#btnLogout { display:none; }
.admin-active #btnLogout { display:inline-block; }

.equipe { padding:10px; margin:5px 0; border-radius:8px; color:#000; }
button{ cursor:pointer; }
</style>
</head>
<body class="pb-10">

<section class="relative w-full h-[300px] md:h-[400px] bg-zinc-900 border-b-4 border-red-600">
<img id="bannerImg" src="https://images.alphacoders.com" class="w-full h-full object-cover opacity-60">
</section>

<nav class="max-w-6xl mx-auto flex justify-between items-center p-6 bg-zinc-900 border-b border-zinc-800">

<div class="flex gap-4">
<button onclick="abrirModal()" class="bg-red-600 px-6 py-2 rounded text-xs font-bold uppercase">Alistar-se</button>
<button onclick="abrirLogin()" class="bg-blue-600 px-6 py-2 rounded text-xs font-bold uppercase">Login</button>
</div>

<div class="flex gap-3">
<button onclick="loginAdmin()">Painel Admin</button>
<button id="btnLogout" onclick="logoutAdmin()" class="text-red-600 text-xs uppercase font-bold">Sair</button>
</div>

</nav>

<main class="max-w-6xl mx-auto p-4 mt-8 space-y-10">

<section class="admin-only space-y-6">
<div class="bg-zinc-900 p-6 rounded border-2 border-yellow-600">

<h3 class="text-yellow-500 font-bold uppercase mb-3">Alterar Banner</h3>

<input type="file" id="bannerLocal" accept="image/*" class="mb-2 text-xs">
<button onclick="uploadLocalBanner()" class="bg-green-600 px-3 py-1 text-xs rounded">Imagem Local</button>

<div class="mt-3">
<input id="bannerLink" placeholder="Link da imagem online" class="w-full bg-black border border-zinc-700 p-2 text-white mb-2">
<button onclick="usarLinkBanner()" class="bg-blue-600 px-3 py-1 text-xs rounded">Usar Link</button>
</div>

<hr class="my-4 border-zinc-700">

<h3 class="text-yellow-500 font-bold mb-3 uppercase">Sorteador</h3>
<button onclick="sortearEquipes()" class="bg-blue-600 px-4 py-2 rounded text-xs">Sortear Times</button>
<div id="equipesContainer" class="mt-3"></div>

</div>
</section>

<div class="bg-zinc-900 rounded border border-zinc-800 overflow-hidden">
<table class="w-full text-left">
<thead class="bg-black text-zinc-500 text-xs uppercase">
<tr>
<th class="p-4">Rank</th>
<th class="p-4">Nome</th>
<th class="p-4 text-center">Partidas</th>
<th class="p-4 text-center text-red-500">Kills</th>
<th class="p-4 text-right admin-only">Ações</th>
</tr>
</thead>
<tbody id="rankBody"></tbody>
</table>
</div>

</main>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDkwukyKZVEZKiP4J75tkUNDisqaC4KLlk",
  authDomain: "equipeodio-715f6.firebaseapp.com",
  projectId: "equipeodio-715f6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const docRef = doc(db,"site","dados");

let aprovados=[];
let bannerSalvo="";
let isAdmin=false;

await getDoc(docRef).then(async snap=>{
  if(!snap.exists()){
    await setDoc(docRef,{rank:[],banner:"https://images.alphacoders.com"});
  }
});

onSnapshot(docRef, snap=>{
  if(snap.exists()){
    const d = snap.data();
    aprovados=d.rank||[];
    bannerSalvo=d.banner||"https://images.alphacoders.com";
    bannerImg.src=bannerSalvo;
    renderRank();
  }
});

async function salvar(){
  await setDoc(docRef,{rank:aprovados,banner:bannerSalvo},{merge:true});
}

/* ADMIN */

window.loginAdmin = ()=>{
  const senha = prompt("Senha Admin:");
  if(senha==="123"){
    isAdmin=true;
    document.body.classList.add("admin-active");
  }
};

window.logoutAdmin = ()=>{
  isAdmin=false;
  document.body.classList.remove("admin-active");
};

/* BANNER */

window.uploadLocalBanner = ()=>{
  const file = bannerLocal.files[0];
  if(!file) return alert("Selecione imagem");

  const reader = new FileReader();
  reader.onload = async e=>{
    bannerSalvo = e.target.result;
    await salvar();
  };
  reader.readAsDataURL(file);
};

window.usarLinkBanner = async ()=>{
  const link = bannerLink.value.trim();
  if(!link) return alert("Link inválido");
  bannerSalvo = link;
  await salvar();
};

/* RANK */

window.addScore = async nome=>{
  const k=parseInt(prompt("Kills","0"))||0;
  const idx=aprovados.findIndex(p=>p.nome===nome);
  if(idx>-1){
    aprovados[idx].matches+=1;
    aprovados[idx].kills+=k;
    await salvar();
  }
};

function renderRank(){
  rankBody.innerHTML="";
  aprovados.forEach((p,i)=>{
    rankBody.innerHTML+=`
    <tr class="border-b border-zinc-800">
      <td class="p-4">#${i+1}</td>
      <td class="p-4">${p.nome}</td>
      <td class="p-4 text-center">${p.matches}</td>
      <td class="p-4 text-center text-red-500">${p.kills}</td>
      <td class="p-4 text-right admin-only">
        <button onclick="addScore('${p.nome}')" class="bg-blue-600 px-2 py-1 text-xs rounded">+K</button>
      </td>
    </tr>`;
  });
}

/* SORTEADOR */

window.sortearEquipes = ()=>{
  if(aprovados.length<2) return alert("Precisa de 2 jogadores");

  const lista=[...aprovados].sort(()=>Math.random()-0.5);
  const metade=Math.ceil(lista.length/2);

  const time1=lista.slice(0,metade).map(p=>p.nome);
  const time2=lista.slice(metade).map(p=>p.nome);

  equipesContainer.innerHTML=`
  <div class="equipe bg-red-500">Time 1: ${time1.join(", ")}</div>
  <div class="equipe bg-blue-500">Time 2: ${time2.join(", ")}</div>`;
};

</script>
</body>
</html>
