<!-- CÓDIGO RESTAURADO BASE 25/02 FUNCIONANDO -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equipe [ODIO]</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Oswald',sans-serif;background:#050505;color:#eee; }
.admin-only { display:none; }
.equipe { padding:10px;margin:5px 0;border-radius:8px;color:#000; }
button{ cursor:pointer; }
</style>
</head>
<body>

<img id="bannerImg" src="" style="width:100%;height:300px;object-fit:cover;">

<button onclick="abrirModal()">Alistar-se</button>
<button onclick="loginAdmin()">Admin</button>

<table border="1" width="100%">
<thead>
<tr>
<th>#</th>
<th>Nome</th>
<th>Partidas</th>
<th>Kills</th>
<th class="admin-only">Ações</th>
</tr>
</thead>
<tbody id="rankBody"></tbody>
</table>

<div id="listaEspera" class="admin-only"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyDkwukyKZVEZKiP4J75tkUNDisqaC4KLlk",
  authDomain:"equipeodio-715f6.firebaseapp.com",
  projectId:"equipeodio-715f6",
  storageBucket:"equipeodio-715f6.firebasestorage.app",
  messagingSenderId:"399735990964",
  appId:"1:399735990964:web:6baa2428bc49c23d7845e1"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const docRef=doc(db,"site","dados");

let aprovados=[], espera=[], bannerSalvo="", isAdmin=false;

async function iniciar(){
  const snap=await getDoc(docRef);
  if(!snap.exists()){
    await setDoc(docRef,{rank:[],espera:[],banner:""});
  }
}
await iniciar();

onSnapshot(docRef,snap=>{
  if(!snap.exists()) return;
  const d=snap.data();
  aprovados=d.rank||[];
  espera=d.espera||[];
  bannerSalvo=d.banner||"";
  if(bannerSalvo) bannerImg.src=bannerSalvo;
  render();
});

async function salvar(){
  await setDoc(docRef,{
    rank:aprovados,
    espera:espera,
    banner:bannerSalvo
  });
}

window.abrirModal=()=>{
  const nome=prompt("Nome:");
  if(!nome) return;
  espera.push({nome,id:Date.now()});
  salvar();
};

window.loginAdmin=()=>{
  if(prompt("Senha admin:")==="123"){
    isAdmin=true;
    document.querySelectorAll(".admin-only").forEach(e=>e.style.display="block");
  }
};

window.aprovar=(id)=>{
  const idx=espera.findIndex(p=>p.id===id);
  if(idx===-1) return;
  const j=espera.splice(idx,1)[0];
  aprovados.push({nome:j.nome,matches:0,kills:0});
  salvar();
};

window.addScore=(nome)=>{
  const k=parseInt(prompt("Kills","0"))||0;
  const j=aprovados.find(p=>p.nome===nome);
  if(!j) return;
  j.matches++;
  j.kills+=k;
  salvar();
};

function render(){
  rankBody.innerHTML="";
  aprovados.forEach((p,i)=>{
    rankBody.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td>${p.nome}</td>
      <td>${p.matches}</td>
      <td>${p.kills}</td>
      <td class="admin-only">
        <button onclick="addScore('${p.nome}')">+K</button>
      </td>
    </tr>`;
  });

  listaEspera.innerHTML="";
  espera.forEach(p=>{
    listaEspera.innerHTML+=`
    <div>${p.nome}
    <button onclick="aprovar(${p.id})">Aprovar</button>
    </div>`;
  });
}
</script>
</body>
</html>
