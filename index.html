<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equipe [ODIO] - Oficial</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Oswald', sans-serif; background: #050505; color: #eee; }
.admin-only { display: none; }
.equipe { padding: 10px; margin:5px 0; border-radius:8px; color:#000; }
button{ cursor:pointer; }
#infoEquipes { margin-bottom: 10px; font-weight: bold; color: #fff; }
</style>
</head>
<body class="pb-10">

<section class="relative w-full h-[300px] md:h-[400px] bg-zinc-900 border-b-4 border-red-600">
<img id="bannerImg" src="https://images.alphacoders.com" class="w-full h-full object-cover opacity-60">
</section>

<!-- NAV -->
<nav class="max-w-6xl mx-auto flex justify-between items-center p-6 bg-zinc-900 border-b border-zinc-800">

<div class="flex gap-4">
<button onclick="abrirModal()" class="bg-red-600 px-6 py-2 rounded text-xs font-bold uppercase">
Alistar-se
</button>

<button onclick="abrirLogin()" class="bg-blue-600 px-6 py-2 rounded text-xs font-bold uppercase">
Login
</button>
</div>

<div class="flex gap-3 items-center">
<button onclick="loginAdmin()" class="text-white text-xs uppercase">
Painel Admin
</button>

<button id="btnLogoutAdmin"
onclick="logoutAdmin()"
class="hidden text-red-500 text-xs uppercase">
Sair
</button>
</div>

</nav>

<main class="max-w-6xl mx-auto p-4 mt-8 space-y-10">

<section id="adminPanel" class="admin-only space-y-6">
<div class="bg-zinc-900 p-6 rounded border-2 border-yellow-600">

<h3 class="text-yellow-500 font-bold mb-3 uppercase">Recrutas</h3>
<div id="listaEspera" class="space-y-2 max-h-[150px] overflow-y-auto"></div>

<h3 class="text-yellow-500 font-bold mb-3 uppercase mt-4">
Aprovados <span id="contagemAprovados" class="text-white text-xs"></span>
</h3>
<div id="listaAprovados" class="space-y-2 max-h-[150px] overflow-y-auto"></div>

<h3 class="text-yellow-500 font-bold mb-3 uppercase mt-4">Sorteador</h3>
<div id="infoEquipes"></div>
<button onclick="sortearEquipes()" class="bg-blue-600 px-4 py-2 rounded text-xs">
Sortear Times
</button>
<div id="equipesContainer" class="mt-2"></div>

</div>
</section>

<div class="bg-zinc-900 rounded border border-zinc-800 overflow-hidden">
<table class="w-full text-left">
<thead class="bg-black text-zinc-500 text-xs uppercase">
<tr>
<th class="p-4">Rank</th>
<th class="p-4">Nome</th>
<th class="p-4 text-center">Partidas</th>
<th class="p-4 text-center text-red-500">Kills</th>
<th class="p-4 text-right admin-only">Ações</th>
</tr>
</thead>
<tbody id="rankBody"></tbody>
</table>
</div>

</main>

<!-- MODAL CADASTRO -->
<div id="modalCadastro" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden p-4">
<div class="bg-zinc-900 p-8 rounded border border-red-600 max-w-md w-full">
<h2 class="text-2xl font-bold mb-6 text-center uppercase">Alistamento</h2>
<input id="regNome" placeholder="Nome no COD" class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">
<input id="regEmail" placeholder="Email" type="email" class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">
<input id="regFone" placeholder="Telefone" class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">
<button onclick="solicitarEntrada()" class="w-full bg-red-600 py-3 font-bold uppercase">Enviar Cadastro</button>
<button onclick="fecharModal()" class="w-full text-zinc-600 text-xs uppercase mt-2">Fechar</button>
</div>
</div>

<!-- MODAL LOGIN -->
<div id="modalLogin" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden p-4">
<div class="bg-zinc-900 p-8 rounded border border-blue-600 max-w-md w-full">
<h2 class="text-2xl font-bold mb-6 text-center uppercase">Login</h2>
<input id="loginEmail" placeholder="Email" class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">
<input id="loginSenha" type="password" placeholder="Senha" class="w-full bg-black border border-zinc-700 p-3 rounded text-white mb-2">
<button onclick="fazerLogin()" class="w-full bg-blue-600 py-3 font-bold uppercase">Entrar</button>
<button onclick="fecharLogin()" class="w-full text-zinc-600 text-xs uppercase mt-2">Fechar</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDkwukyKZVEZKiP4J75tkUNDisqaC4KLlk",
  authDomain: "equipeodio-715f6.firebaseapp.com",
  projectId: "equipeodio-715f6",
  storageBucket: "equipeodio-715f6.firebasestorage.app",
  messagingSenderId: "399735990964",
  appId: "1:399735990964:web:6baa2428bc49c23d7845e1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const docRef = doc(db,"site","dados");

let aprovados=[], espera=[], listaAprovadosData=[], bannerSalvo="https://images.alphacoders.com", isAdmin=false;

async function inicializar(){
  const snap = await getDoc(docRef);
  if(!snap.exists()) await setDoc(docRef,{rank:[],espera:[],aprovados:[],banner:bannerSalvo});
}
await inicializar();

onSnapshot(docRef, snap=>{
  if(snap.exists()){
    const d = snap.data();
    aprovados=d.rank||[];
    espera=d.espera||[];
    listaAprovadosData=d.aprovados||[];
    bannerSalvo=d.banner||bannerSalvo;
    bannerImg.src=bannerSalvo;
    renderRank();
    renderAdmin();
  }
});

async function salvar(){
  await setDoc(docRef,{
    rank:aprovados,
    espera:espera,
    aprovados:listaAprovadosData,
    banner:bannerSalvo
  });
}

window.abrirModal=()=>modalCadastro.classList.remove("hidden");
window.fecharModal=()=>modalCadastro.classList.add("hidden");
window.abrirLogin=()=>modalLogin.classList.remove("hidden");
window.fecharLogin=()=>modalLogin.classList.add("hidden");

window.loginAdmin=()=>{
  const senha=prompt("Senha Admin:");
  if(senha==="123"){
    isAdmin=true;
    document.querySelectorAll(".admin-only").forEach(e=>e.style.display="block");
    btnLogoutAdmin.classList.remove("hidden");
  }else if(senha!==null){
    alert("Senha incorreta!");
  }
};

window.logoutAdmin=()=>{
  isAdmin=false;
  document.querySelectorAll(".admin-only").forEach(e=>e.style.display="none");
  btnLogoutAdmin.classList.add("hidden");
  alert("Admin desconectado!");
};

window.solicitarEntrada=async()=>{
  const nome=regNome.value.trim();
  const email=regEmail.value.trim();
  const fone=regFone.value.trim();
  if(!nome||!email||!fone){ alert("Preencha todos!"); return;}

  const duplicado=[...espera,...listaAprovadosData]
  .some(p=>p.nome===nome||p.email===email||p.fone===fone);
  if(duplicado){ alert("Já cadastrado!"); return;}

  espera.push({nome,email,fone,senha:"",id:Date.now()});
  await salvar();
  alert("Pedido enviado!");
  fecharModal();
};

window.fazerLogin=async()=>{
  const email=loginEmail.value.trim();
  const senha=loginSenha.value.trim();
  const user=listaAprovadosData.find(p=>p.email===email);
  if(!user){ alert("Usuário não aprovado!"); return;}

  if(!user.senha){
    const nova=prompt("Primeiro acesso! Crie senha alfanumérica (mín 6)");
    if(!nova||nova.length<6||!/\d/.test(nova)||!/[a-zA-Z]/.test(nova)){alert("Senha inválida");return;}
    user.senha=nova;
    await salvar();
    alert("Senha criada! Faça login novamente.");
    return;
  }

  if(user.senha!==senha){ alert("Senha incorreta!"); return;}
  alert("Login realizado!");
  fecharLogin();
};

/* resto igual original (aprovar, reprovar, rank, sorteador...) */
</script>
</body>
</html>
